"0","dr <- function(data) {"
"0","# outcome"
"0","Z = data$MaskMandateLeastNonvax"
"0","Y = data$growth30"
"0",""
"0","ols <- lm(growth30~ MaskMandateLeastNonvax + "
"0","          medAge + over65pct +"
"0","          pplpovpct +"
"0","          asianpct + blkafrpct + "
"0","          ppl_density +"
"0","          `Republican leading 2020` +"
"0","          X8.18.21death + "
"0","          fullvaxrate7 + "
"0","          mobility0825dim1 + mobility0825dim2"
"0","          , data = data)"
"0",""
"0","Y_head = predict(ols, data)"
"0","res = Y - Y_head"
"0",""
"0","# pscore"
"0","#ps_head <- list()"
"0",""
"0","#for (i in 1:1000) {"
"0","  rf <- randomForest(data.matrix(data[,covariates[-c(1:5)]]), y = as.factor(data$MaskMandateLeastNonvax), na.action = na.omit)"
"0","#  ps_head[[i]] <- pmax(rf$votes[,2], 0.05)"
"0","#}"
"0",""
"0","# doubly robust"
"0","#pscore <- apply(data.frame(ps_head), mean, MARGIN = c(1))"
"0","pscore <- pmax(rf$votes[,2], 0.05)"
"0","#outcome1 = predict(ols, data[data$MaskMandateLeastNonvax==1, ]) "
"0","#outcome0 = predict(ols, data[data$MaskMandateLeastNonvax==0, ]) "
"0","#tau = mean(outcome1 - outcome0) + mean(Z*res/pscore - (1-Z)*res/(1-pscore))"
"0","#return(tau)"
"0",""
"0","outcome1 = mean(Y_head + Z*res/pscore)"
"0","outcome0 = mean(Y_head + (1-Z)*res/(1-pscore))"
"0","tau = mean(outcome1 - outcome0)"
"0","return(c(outcome1, outcome0, tau))"
"0",""
"0","}"
"0",""
"0",""
"0","library(doParallel)"
"0","library(snow)"
"0","workers = makeCluster(4, type = 'SOCK')"
"0","registerDoParallel(workers)"
"0",""
"0","n.sample = nrow(data)"
"0","boot.est = replicate(500, "
"0","                     {id.boot = sample(1:n.sample, n.sample, replace = TRUE)"
"0","                     dr(data = data[id.boot,])})"
"2","Warning in for (a in args) { :"
"2","
 "
"2"," closing unused connection 10 (<-DESKTOP-2QV02IH:11263)
"
"2","Warning in for (a in args) { :"
"2","
 "
"2"," closing unused connection 9 (<-DESKTOP-2QV02IH:11263)
"
"2","Warning in for (a in args) { :"
"2","
 "
"2"," closing unused connection 8 (<-DESKTOP-2QV02IH:11263)
"
"2","Warning in for (a in args) { :"
"2","
 "
"2"," closing unused connection 7 (<-DESKTOP-2QV02IH:11263)
"
"0","dr(data)"
"1","[1]"
"1","  1.118195510"
"1","  1.123503853"
"1"," -0.005308344"
"1","
"
